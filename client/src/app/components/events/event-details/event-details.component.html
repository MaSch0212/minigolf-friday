<div class="flex h-full w-full max-w-[40rem] flex-col gap-4">
  <p-button
    [label]="translations.events_backToEvents()"
    [text]="true"
    icon="i-[mdi--arrow-left]"
    (onClick)="navigateBack()"
  />

  @if (isBusy()) {
    <p-progressSpinner class="m-8 self-center" />
  } @else if (hasFailed()) {
    <p-messages severity="error">
      <ng-template pTemplate>
        <span class="i-[mdi--close-circle-outline] mr-2"></span>
        <span
          >{{ translations.events_error_loadOne() }} {{ translations.shared_tryAgainLater() }}</span
        >
      </ng-template>
    </p-messages>
  } @else {
    @if (event(); as event) {
      <p-card>
        <div class="flex flex-col items-center">
          <div class="grid grid-cols-[auto,1fr] gap-x-4 gap-y-2">
            <div class="truncate text-right font-semibold">{{ translations.events_date() }}:</div>
            <div>{{ event.date | date: 'mediumDate' : undefined : locale() }}</div>
            <div class="truncate font-semibold">
              {{ translations.events_registrationDeadline() }}:
            </div>
            <div>{{ event.registrationDeadline | date: 'medium' : undefined : locale() }}</div>
          </div>
        </div>
      </p-card>

      <div class="mt-4 flex flex-row items-center gap-2">
        <h2 class="m-0 grow">{{ translations.events_timeslots() }}</h2>
        <p-button
          [label]="translations.shared_add()"
          icon="i-[mdi--plus]"
          (onClick)="createTimeslotDialog.open()"
        />
      </div>

      <div class="flex grow flex-col overflow-auto">
        <div class="rounded-lg border-[1px] border-solid border-surface-d bg-surface-a">
          @for (timeslot of timeslots(); track timeslot.id; let index = $index) {
            <a
              class="block min-w-0 truncate border-0 border-solid border-surface-d px-4 py-2 leading-8 text-text-color no-underline hover:bg-surface-c"
              [class.border-t-[1px]]="index > 0"
              [routerLink]="['timeslots', timeslot.id]"
              pRipple
            >
              <div class="flex flex-row">
                <span>
                  {{ timeslot.time.hour | number: '2.0-0' }}:{{
                    timeslot.time.minute | number: '2.0-0'
                  }}</span
                >
                <div class="grow"></div>
                <span>{{
                  translations.events_playerAmount()
                    | interpolate: { amount: timeslot.playerIds.length }
                }}</span>
              </div>
            </a>
          }
          @if (event.timeslots.length === 0) {
            <div class="px-4 py-2 text-center leading-8">
              {{ translations.events_noTimeslots() }}
            </div>
          }
        </div>

        <p-button
          class="mt-12 self-center"
          severity="danger"
          [label]="translations.events_deleteEvent()"
          icon="i-[mdi--delete-outline]"
          (onClick)="deleteEvent()"
        />
      </div>

      <app-create-event-timeslot #createTimeslotDialog [event]="event" />
    } @else {
      <div class="mt-16 flex flex-col items-center gap-8">
        <span class="i-[mdi--close-octagon] text-[8rem] text-red-500"></span>
        <h1 class="m-0 text-center">{{ translations.events_notFound() }}</h1>
        <p-button
          [label]="translations.events_backToEvents()"
          icon="i-[mdi--arrow-left]"
          (onClick)="navigateBack()"
        />
      </div>
    }
  }
</div>
